<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-getting-started/layered-architecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Exploring the Evo.lua API | Evo.lua</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://evo-lua.github.io/docs/getting-started/layered-architecture"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Exploring the Evo.lua API | Evo.lua"><meta data-rh="true" name="description" content="A quick intro to the Lua libraries and FFI bindings"><meta data-rh="true" property="og:description" content="A quick intro to the Lua libraries and FFI bindings"><link data-rh="true" rel="icon" href="/img/caterpillar.png"><link data-rh="true" rel="canonical" href="https://evo-lua.github.io/docs/getting-started/layered-architecture"><link data-rh="true" rel="alternate" href="https://evo-lua.github.io/docs/getting-started/layered-architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://evo-lua.github.io/docs/getting-started/layered-architecture" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6c3174a8.css">
<link rel="preload" href="/assets/js/runtime~main.70a2e394.js" as="script">
<link rel="preload" href="/assets/js/main.ca219051.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/caterpillar.png" alt="Evo.lua Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/caterpillar.png" alt="Evo.lua Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Evo.lua</b></a><a class="navbar__item navbar__link" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/docs/category/api">API Overview</a><a class="navbar__item navbar__link" href="/docs/security-policy">Security Policy</a><a class="navbar__item navbar__link" href="/docs/contributing">Contributing</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/evo-lua" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Documentation Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/evo-in-a-nutshell">Introduction: Evo in a Nutshell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/installation">Setup: Installation and Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/core-concepts">Overview: Core Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/layered-architecture">Exploring the Evo.lua API</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/how-to-guides">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/background-information">Background Information</a><button aria-label="Toggle the collapsible sidebar category &#x27;Background Information&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/references">References</a><button aria-label="Toggle the collapsible sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/security-policy">Security Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contributing">Contributing</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/getting-started"><span itemprop="name">Getting Started</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Exploring the Evo.lua API</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Exploring the Evo.lua API</h1><p>A quick intro to the Lua libraries and FFI bindings</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nonstandard-libraries">Nonstandard Libraries<a href="#nonstandard-libraries" class="hash-link" aria-label="Direct link to Nonstandard Libraries" title="Direct link to Nonstandard Libraries">​</a></h2><p>When using a standard Lua (or LuaJIT) interpreter, the selection of modules that can be used is somewhat limited. This is one of the major issues Evo seeks to solve, by shipping with a much larger number of third-party libraries as well as additional builtin modules. All of these are available to any script run by the interpreter&#x27;s CLI, so you might want to know what kind of apps you can build with them.</p><p>While browsing the <a href="/docs/category/api">API documentation</a> should give you a general idea, read the following sections if you want to learn about a few of the most important libraries and why some of them might look like they&#x27;re doing the same things slightly differently. You&#x27;ll see there&#x27;s a very good reason for that, but in order to truly understand why we must take a brief look at how Evo actually works behind the scenes.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="layered-architecture">Layered Architecture<a href="#layered-architecture" class="hash-link" aria-label="Direct link to Layered Architecture" title="Direct link to Layered Architecture">​</a></h2><p>The most important thing to remember is this: <strong>Evo consists of multiple API layers, which add conveniences on top of each other</strong>.</p><ul><li>At the lowest level, a C++ program is running the Lua interpreter and controls the application lifecycle</li><li>At the highest level, you invoke the command line to run your code, which calls into the lower layers</li><li>In between, there are multiple levels (a bit like an onion - though hopefully they won&#x27;t make you cry)</li><li>Evo effectively translates low-level calls to high-level calls, and vice versa, when running any script</li><li>You yourself get to choose at which layer of the &quot;onion&quot; you want to write your program code</li></ul><p>Generally speaking, the more control you need over what your program is doing (including performance-critical operations like memory allocations and buffer copies), the lower the level at which you will be writing your code. With great power comes great responsibility, however, which is why beginners may want to start at the highest levels first. Evo&#x27;s APIs are designed such that you can easily move between the highest and the lowest layer as needed, to hopefully find the level of abstraction that works best for your project.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phenomenal-cosmic-powers">Phenomenal Cosmic Powers<a href="#phenomenal-cosmic-powers" class="hash-link" aria-label="Direct link to Phenomenal Cosmic Powers" title="Direct link to Phenomenal Cosmic Powers">​</a></h2><p>Your app gets to make a trade-off between convenience and power by selecting which APIs to call into. You can of course mix and match these calls however you see fit, though there&#x27;s not often a reason to work at the lower levels when you&#x27;re just starting out.</p><p>Like with any trade-off, making the right decision involves knowing the benefits and drawbacks. And here they are:</p><ul><li>At the highest level, you can easily perform standard tasks (like building a self-contained executable) using just the command line</li><li>Beneath that are the namespaced APIs and nonstandard Lua libraries, which are optimized for convenience and common use cases</li><li>For less frequent use cases or doing things in a slightly unusual way, you may need to use the embedded Lua C-API bindings</li><li>The lowest layers available from Lua may or may not require manual memory management and careful parameter checking</li><li>Here, you&#x27;ll definitely want some experience with the <a href="https://luajit.org/ext_ffi_tutorial.html" target="_blank" rel="noopener noreferrer">Foreign Function Interface</a> and <a href="https://en.wikipedia.org/wiki/Struct_(C_programming_language)" target="_blank" rel="noopener noreferrer">C structs</a>, or <a href="https://en.wikipedia.org/wiki/Segmentation_fault" target="_blank" rel="noopener noreferrer">unhappiness will surely find you</a></li></ul><p>Beneath that, your app won&#x27;t usually go directly as it would involve modifying the runtime&#x27;s code itself (<a href="/docs/how-to-guides/building-from-source">it&#x27;s certainly possible, though</a>).</p><p>If that seems a bit abstract, it may make more sense after the following sections. But first, here&#x27;s a diagram of those layers:</p><p><img loading="lazy" alt="layered-architecture.png" src="/assets/images/layered-architecture-9e1f9e1697b6d87f5459017d4e69c6c5.png" width="3300" height="2100" class="img_CujE"></p><p>You can roughly equate the two axes to &quot;Raw power&quot; and &quot;Level of abstraction&quot;. Let&#x27;s now consider a few examples to make this clearer.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="file-system-access">File System Access<a href="#file-system-access" class="hash-link" aria-label="Direct link to File System Access" title="Direct link to File System Access">​</a></h3><p>Since accessing files on disk is one of the few things even the Lua standard library supports, there are many ways to do it:</p><ul><li>The simplest way is to use the high-level <a href="/docs/references/api/namespaces/filesystem">C_FileSystem</a> APIs for a &quot;one and done&quot; approach, which is generally not the most efficient</li><li>You can also try the standard Lua <a href="https://www.lua.org/manual/5.1/manual.html#5.7" target="_blank" rel="noopener noreferrer">io library</a>, which is simple but doesn&#x27;t support <a href="/docs/getting-started/core-concepts#asynchronous-execution-model">non-blocking I/O</a> (so its use is discouraged in Evo)</li><li>For asynchronous I/O you currently need to fall back to the <a href="/docs/references/api/bindings/uv">libuv</a> Lua bindings, though they&#x27;re safe as they don&#x27;t rely on the FFI</li><li>If you instead wanted to avoid all buffer copies and work with <code>cdata</code> types directly, you&#x27;d need to head into the C++ layer</li></ul><p>Note that in this case, there isn&#x27;t actually a way to use the FFI and improve performance by avoiding Lua string copies (...yet).
Technically, you can use the FFI with platform-specific APIs, but that&#x27;s not portable. However, better runtime support for file system I/O is planned.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-programming">Network Programming<a href="#network-programming" class="hash-link" aria-label="Direct link to Network Programming" title="Direct link to Network Programming">​</a></h3><p>Distributed systems is an area that&#x27;s usually performance-sensitive, so that it&#x27;s warranted to consider the lower-level APIs:</p><ul><li>The builtin <code>HttpServer</code> and <code>WebSocket</code> modules are relatively easy to use, but they do incur some unavoidable overhead</li><li>For more fine-grained control, there&#x27;s two options; the first is using the Lua bindings to libuv and building on top of TCP or UDP</li><li>However, this is certainly not the fastest approach (and doesn&#x27;t provide support for HTTP or WS out of the box) - but <a href="/docs/references/api/bindings/uws">uws</a> does!</li><li>In this case you&#x27;d be responsible for handling events, which can be tricky due to technical constraints, <em>and</em> memory management</li></ul><p>Again there is the option to use the FFI, but only with non-portable APIs - which could be made easier with runtime support.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="webviews">WebViews<a href="#webviews" class="hash-link" aria-label="Direct link to WebViews" title="Direct link to WebViews">​</a></h3><p>Opening a WebView is one of the more interesting tasks from a technical perspective. There are a few ways to do it in Evo:</p><ul><li>The high-level <a href="/docs/references/api/namespaces/webview">C_WebView</a> namespace makes it very easy to just open a browser window, change the URL, or run JavaScript in it</li><li>However, it doesn&#x27;t expose all of the underlying <a href="/docs/references/api/bindings/webview">webview FFI</a> bindings, which can give more control over the JavaScript execution</li><li>In fact, there are some advanced use cases (such as managing multiple windows) that require a combination of <a href="/docs/references/api/bindings/glfw">glfw</a> and webview</li><li>If you now wanted to control policies or custom URL schemes, you&#x27;d have to go into the C++ layer as that isn&#x27;t exposed to Lua</li></ul><p>It&#x27;s still possible to, say, display a WebView in your own native window, but since it&#x27;s an uncommon use case this requires more effort.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>You&#x27;ve seen how the Lua APIs in Evo are layered such that your app can call into it at different levels of abstraction. Hopefully, you now know why parts of the API are tagged with the &quot;FFI&quot; label in the documentation (they&#x27;re low-level and can cause program instability if misused). And after having seen a few examples, you can probably find your way around the API reference to decide which libraries you want to call into, when you should consider making use of the FFI bindings yourself, and what responsibilities that places on your app.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/evo-lua/evo-lua.github.io/edit/main/docs/getting-started/layered-architecture.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/getting-started/core-concepts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview: Core Concepts</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/how-to-guides"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How-to Guides</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#nonstandard-libraries" class="table-of-contents__link toc-highlight">Nonstandard Libraries</a></li><li><a href="#layered-architecture" class="table-of-contents__link toc-highlight">Layered Architecture</a></li><li><a href="#phenomenal-cosmic-powers" class="table-of-contents__link toc-highlight">Phenomenal Cosmic Powers</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#file-system-access" class="table-of-contents__link toc-highlight">File System Access</a></li><li><a href="#network-programming" class="table-of-contents__link toc-highlight">Network Programming</a></li><li><a href="#webviews" class="table-of-contents__link toc-highlight">WebViews</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021-2023 · Evo.lua authors and contributors</div></div></div></footer></div>
<script src="/assets/js/runtime~main.70a2e394.js"></script>
<script src="/assets/js/main.ca219051.js"></script>
</body>
</html>