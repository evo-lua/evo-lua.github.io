<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-background-information/design/implemented/unit-test-runner" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">RFC: Builtin Test Runner | Evo.lua</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://evo-lua.github.io/docs/background-information/design/implemented/unit-test-runner"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="RFC: Builtin Test Runner | Evo.lua"><meta data-rh="true" name="description" content="This document describes design goals for a BDD-style unit test runner"><meta data-rh="true" property="og:description" content="This document describes design goals for a BDD-style unit test runner"><link data-rh="true" rel="icon" href="/img/caterpillar.png"><link data-rh="true" rel="canonical" href="https://evo-lua.github.io/docs/background-information/design/implemented/unit-test-runner"><link data-rh="true" rel="alternate" href="https://evo-lua.github.io/docs/background-information/design/implemented/unit-test-runner" hreflang="en"><link data-rh="true" rel="alternate" href="https://evo-lua.github.io/docs/background-information/design/implemented/unit-test-runner" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ed6fd9ed.css">
<link rel="preload" href="/assets/js/runtime~main.2db24602.js" as="script">
<link rel="preload" href="/assets/js/main.f5c2afea.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/caterpillar.png" alt="Evo.lua Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/caterpillar.png" alt="Evo.lua Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Evo.lua</b></a><a class="navbar__item navbar__link" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/docs/category/api">API Overview</a><a class="navbar__item navbar__link" href="/docs/security-policy">Security Policy</a><a class="navbar__item navbar__link" href="/docs/contributing">Contributing</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/evo-lua" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Documentation Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/how-to-guides">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/background-information">Background Information</a><button aria-label="Toggle the collapsible sidebar category &#x27;Background Information&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/design-documents">Design Documents</a><button aria-label="Toggle the collapsible sidebar category &#x27;Design Documents&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/drafts">Drafts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Drafts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/implemented">Implemented</a><button aria-label="Toggle the collapsible sidebar category &#x27;Implemented&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/implemented/build-system-rework">RFC: Ninja-based Builds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/implemented/code-conventions">RFC: Code Conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/implemented/event-handling">RFC: Event Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/implemented/testing-architecture">RFC: Smoke Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/background-information/design/implemented/unit-test-runner">RFC: Builtin Test Runner</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/template">Template</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/luajit-notes">LuaJIT Notes</a><button aria-label="Toggle the collapsible sidebar category &#x27;LuaJIT Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/the-evo-philosophy">The Evo Philosophy</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/references">References</a><button aria-label="Toggle the collapsible sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/security-policy">Security Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contributing">Contributing</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/background-information"><span itemprop="name">Background Information</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/design-documents"><span itemprop="name">Design Documents</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/implemented"><span itemprop="name">Implemented</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">RFC: Builtin Test Runner</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>RFC: Builtin Test Runner</h1><p>This document describes design goals for a BDD-style unit test runner</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h2><p>There&#x27;s a need for unit testing, but the existing frameworks are largely inactive and can&#x27;t easily be adapted.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-philosophy">Testing Philosophy<a href="#testing-philosophy" class="hash-link" aria-label="Direct link to Testing Philosophy" title="Direct link to Testing Philosophy">​</a></h2><p>BDD style, meaning <code>describe</code> and <code>it</code> is used to define test suites. Why?</p><ul><li>Easy to understand</li><li>Requires little boilerplate</li><li>Flexible enough for all basic unit testing needs</li><li>Simple enough to implement from scratch</li><li>Lends itself well to domain-driven design</li></ul><p>Guiding principle: Focus on what matters - fast feedback and iteration speed above extensive feature sets.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="organizing-tests">Organizing Tests<a href="#organizing-tests" class="hash-link" aria-label="Direct link to Organizing Tests" title="Direct link to Organizing Tests">​</a></h2><p>No concept of test suites and test cases should be implemented in code. Instead, Lua scripts (files) <em>are</em> test suites. Separations inside them are only relevant for the reporting stage (for readability&#x27;s sake).</p><p>The core idea here is that all those fancy bells and whistles detract from the one (and only) thing developers care about when writing tests: Making sure that the code works, as fast as possible and with minimal headaches. No one enjoys writing tests, after all, and since test code needs to be maintained as part of the code base it might as well be &quot;real code&quot;.</p><p>For the reporting step, and for backwards compatibility, using <em>describe</em> and <em>it</em> functions should be possible. However, these don&#x27;t need to do anything other than visually indent the printed labels and are otherwise purely optional.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-features">Additional Features<a href="#additional-features" class="hash-link" aria-label="Direct link to Additional Features" title="Direct link to Additional Features">​</a></h2><p>Various commonly-included features have been considered for an initial prototype.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nonstandard-assertions">Nonstandard Assertions<a href="#nonstandard-assertions" class="hash-link" aria-label="Direct link to Nonstandard Assertions" title="Direct link to Nonstandard Assertions">​</a></h3><p>Assertions are optionally provided via the <em>assertions</em> library, which should be built into the runtime itself.</p><p>Using the standard Lua <em>assert</em> or a third-party solution (like <em>luassert</em>) is also possible as long as failing tests throw.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronous-tests">Asynchronous Tests<a href="#asynchronous-tests" class="hash-link" aria-label="Direct link to Asynchronous Tests" title="Direct link to Asynchronous Tests">​</a></h3><p>Coroutines can trivially be used to implement asynchronous tests. There&#x27;s really no need for more complexity.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-and-teardown-code">Setup and Teardown Code<a href="#setup-and-teardown-code" class="hash-link" aria-label="Direct link to Setup and Teardown Code" title="Direct link to Setup and Teardown Code">​</a></h3><p>Setup and teardown should be implemented by each test, as appropriate. Special functions could be added later.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-retries-and-pending-tests">Test Retries and Pending Tests<a href="#test-retries-and-pending-tests" class="hash-link" aria-label="Direct link to Test Retries and Pending Tests" title="Direct link to Test Retries and Pending Tests">​</a></h3><p>Flaky tests should be fixed and not retried until they work. Pending or &quot;not-yet-implemented&quot; tests should be removed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-discovery">Test Discovery<a href="#test-discovery" class="hash-link" aria-label="Direct link to Test Discovery" title="Direct link to Test Discovery">​</a></h3><p>Instead of adding fancy discovery logic, CLI flags and other magic, simply passing a list of test files will suffice.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="parallelization">Parallelization<a href="#parallelization" class="hash-link" aria-label="Direct link to Parallelization" title="Direct link to Parallelization">​</a></h3><p>Multiple runners can be spawned via shell scripts or by using the <em>uv</em> library. Better support may be worth adding later.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stubs-mocks--spies">Stubs, Mocks &amp; Spies<a href="#stubs-mocks--spies" class="hash-link" aria-label="Direct link to Stubs, Mocks &amp; Spies" title="Direct link to Stubs, Mocks &amp; Spies">​</a></h3><p>These may be worth adding as a separate library should they become relevant. For the time being, they are not.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-reporting-formats">Additional Reporting Formats<a href="#additional-reporting-formats" class="hash-link" aria-label="Direct link to Additional Reporting Formats" title="Direct link to Additional Reporting Formats">​</a></h3><p>TAP or other formats may be added in the future. But at least for an initial version, that&#x27;s probably not useful enough.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="alternatives">Alternatives<a href="#alternatives" class="hash-link" aria-label="Direct link to Alternatives" title="Direct link to Alternatives">​</a></h2><ul><li>Make <code>busted</code> work the way it should (painful)</li><li>Attempt to fit <code>luaunit</code> into the BDD framework (impedance mismatch)</li><li>Try out some of more niche frameworks listed on <a href="http://lua-users.org/wiki/UnitTesting" target="_blank" rel="noopener noreferrer">lua-users.org</a> (unlikely to be fruitful)</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/evo-lua/evo-lua.github.io/edit/main/docs/background-information/design/implemented/unit-test-runner.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/background-information/design/implemented/testing-architecture"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">RFC: Smoke Testing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/background-information/design/template"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Template</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#testing-philosophy" class="table-of-contents__link toc-highlight">Testing Philosophy</a></li><li><a href="#organizing-tests" class="table-of-contents__link toc-highlight">Organizing Tests</a></li><li><a href="#additional-features" class="table-of-contents__link toc-highlight">Additional Features</a><ul><li><a href="#nonstandard-assertions" class="table-of-contents__link toc-highlight">Nonstandard Assertions</a></li><li><a href="#asynchronous-tests" class="table-of-contents__link toc-highlight">Asynchronous Tests</a></li><li><a href="#setup-and-teardown-code" class="table-of-contents__link toc-highlight">Setup and Teardown Code</a></li><li><a href="#test-retries-and-pending-tests" class="table-of-contents__link toc-highlight">Test Retries and Pending Tests</a></li><li><a href="#test-discovery" class="table-of-contents__link toc-highlight">Test Discovery</a></li><li><a href="#parallelization" class="table-of-contents__link toc-highlight">Parallelization</a></li><li><a href="#stubs-mocks--spies" class="table-of-contents__link toc-highlight">Stubs, Mocks &amp; Spies</a></li><li><a href="#additional-reporting-formats" class="table-of-contents__link toc-highlight">Additional Reporting Formats</a></li></ul></li><li><a href="#alternatives" class="table-of-contents__link toc-highlight">Alternatives</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021-2025 · Evo.lua authors and contributors</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2db24602.js"></script>
<script src="/assets/js/main.f5c2afea.js"></script>
</body>
</html>